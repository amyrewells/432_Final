---
title: "FinalReport"
author: "Amyre"
date: "2025-03-24"
output: html_document
---

# Final Report

## Members

Bonnie Rule (20295738),

Mackenzie Calhoun (20265644),

Amyre Wells (20320047),

Jennah Levac (20169998),

Taylor Pontet-Dasilva (20310351),

Nithila Sathieskumar (20279386)

## Setup

***github***

<https://github.com/amyrewells/432_Final>

***data acquisition***

Data is from: <https://doi.org/10.5061/dryad.vq744> (just the OTU table and mapping.txt). This data can be found in ./data/input

Sequences available through NCBI (Accession numbers KX459698â€“KX460822)

***data transformation***

Abundance data from the OTU table was transformed into relative abundance data. This was done to ensure we investigate the relative make-up of microbe communities, without confounding differences in microbe abundance between samples.

Data was then cleaned and filtered so only microbe OTUs representing over 0.5% of the microbes sampled were kept. This was done as a feature selection step to prevent over-fitting in the models to be run.

Filtered data was then merged with relevant mapping data to categorize samples by species.

The scripts preforming these transformations can be found in ./data/transformations. The data filed used for analysis are found in ./data.

## Question 1- 

### A- Do microbiome communities significantly differ between *E. intermedius* and *E. triangulatus* dung beetle species?

To investigate this question,

```{r}
set.seed(432)
# Using Bray-Curtis dissimilarity matrix for NMDS
otu_data_numeric <- merged_data[, !colnames(merged_data) %in% c("Species"), drop = FALSE]  
otu_data_matrix <- as.matrix(otu_data_numeric)
bray_curtis_dist <- vegdist(otu_data_matrix, method = "bray")

# Run NMDS
nmds_result <- metaMDS(bray_curtis_dist, k = 2, trymax = 100)
nmds_scores <- scores(nmds_result)

# Create a dataframe for NMDS plot
nmds_scores <- as.data.frame(nmds_result$points)
#The scores are being labeled as MDS instead of NMDS but checking the NMDS_results do #confirm monoMDS (the default for NMDS) is being used.Not sure why the axes are now #referred to as MDS in the dataframe
nmds_scores$Species <- merged_data$Species 

# Plot NMDS results
NMDS_Species<- ggplot(nmds_scores, aes(x = MDS1, y = MDS2)) +
  geom_point(aes(color = Species)) + 
  theme_minimal() + 
  labs(title = "NMDS Plot: Dung Beetle Species Microbiome Composition ", x = "NMDS1", y = "NMDS2")

print(NMDS_Species)
#There seems to be some underlying factor that influences microbial communities. #There's no clear association between  dung beetle species and microbial communities.
```

```{r}
# Run a linear model for both NMDS1 and NMDS2 against 'Species'
lm_nmds1 <- lm(MDS1 ~ Species, data = nmds_scores)
lm_nmds2 <- lm(MDS2 ~ Species, data = nmds_scores)

# Summary of the linear model
summary(lm_nmds1)
#The p-value indicates no significant difference between the species in terms of MDS1 values, meaning species E. inter does not explain the variation in microbiome composition along the NMDS1 axis.
summary(lm_nmds2)
#no significant difference between the species in terms of MDS2 values, meaning species E. triang does not explain the variation in microbiome composition along the NMDS2 axis.

# Plot LM
ggplot(nmds_scores, aes(x = MDS1, y = MDS2)) +
  geom_point(aes(color = Species), size = 4) +  # Scatter plot of NMDS1 vs Species
  geom_smooth(method = "lm", aes(color = Species), linetype = "solid", se = FALSE) +
  theme_minimal() +
  labs(x = "NMDS1", y = "NMDS2")
```

### B- Can these differences be used to predict species classification?

By fitting a Random Forest model, we revealed that the make-up of microbial communities can be used to classify E. intermedius and E. triangulatus dung beetle samples with 88.89% accuracy. The confusion matrix of this model is shown in Table 1.

**Table 1**. Confusion Matrix for Random Forest model classifying beetle species from microbe community data. Cohen's Kappa for this table is 0.7662.

```{r}
load("./Figures/RFConfusionMatrix.RData")
print(confusion_matrix)
```

Additionally, we looked at which OTUs were most important in classifying decisions.

**Table 2.** Top 10 most important microbe OTUs in classifying beetle species.

### C- How do microbial communities differ between samples of different species?

##  Question 2

\* Top OTUs were selected and those with vaialiable NCBI data were used for phylogeny
